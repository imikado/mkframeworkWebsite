<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="site/css/bootstrap.min_v2.css" />
    
 
    <title>MkFramework</title>
 <link rel="stylesheet" type="text/css" href="site/css/main.css" media="screen" />
  <link rel="stylesheet" type="text/css" href="site/css/jumbotron.css" media="screen" />


  
<script src="site/js/main.js" type="text/javascript"></script>

<link rel="alternate" type="application/rss+xml" title="RSS" href="news.rss"/>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34332613-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<style>
.container2{
margin-top:40px;

}
</style>
</head>
<body>

<style>
.navbar .navbar-brand{
background: url('site/css/images//logoMk.png') no-repeat 0px 0px ;
padding-left:60px;
}
</style>

<nav class="navbar navbar-expand-md fixed-top navbar-dark bg-dark">
	<a class="navbar-brand" href="#">MKFramework</a>
	<button class="navbar-toggler p-0 border-0" type="button" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="navbar-toggler-icon"></span>
	</button>
	
 

	<div class="navbar-collapse collapse"  >
		<ul class="navbar-nav mr-auto">
		
			
							
				<li class="nav-item ">
					<a  class="nav-link" href="accueil.html">Accueil <span class="sr-only">(current)</span></a>
				</li>
			
				
				
			
							
				<li class="nav-item ">
					<a  class="nav-link" href="news.html">Le site <span class="sr-only">(current)</span></a>
				</li>
			
				
				
			
							
				<li class="nav-item ">
					<a  class="nav-link" href="fonctionnement.html">Pr&eacute;sentation <span class="sr-only">(current)</span></a>
				</li>
			
				
				
			
							
				<li class="nav-item ">
					<a  class="nav-link" href="start.html">Documentation <span class="sr-only">(current)</span></a>
				</li>
			
				
				
			
							
				<li class="nav-item ">
					<a  class="nav-link" href="publishonweb.html">Publications <span class="sr-only">(current)</span></a>
				</li>
			
				
				
			
							
				<li class="nav-item ">
					<a  class="nav-link" href="telecharger.html">T&eacute;l&eacute;charger <span class="sr-only">(current)</span></a>
				</li>
			
				
				
			
							
				<li class="nav-item ">
					<a target="_blank" class="nav-link" href="http://www.developpez.net/forums/f1355/applications/projets/projets-heberges/mkframework/">Forum <span class="sr-only">(current)</span></a>
				</li>
			
				
				
						
			
          
		</ul>
		
		<ul class="navbar-nav  navbar-right">
						<li class="nav-item"><a class="nav-link" style="font-weight:bold" href="podcastsTuto_3.html">FR</a></li>

			<li><a class="nav-link"  href="podcastsTuto_3.html">EN</a></li>
		</ul>
		
	</div>
</nav>
 <style>
 .navbar-custom {
    background-color: #124c5c;
}</style>
<nav class="navbar navbar-expand-md  navbar-custom navbar-dark">
	 

	<div class="navbar-collapse collapse"  >
		<ul class="navbar-nav mr-auto">
	
			
	
		  
  
         
	</ul>
</div>
</nav>


    
      <main role="main">
      
		<div class="container container2">
	 
		<h1>Episode 4: Builder: formulaire d&#039;ajout</h1><h2>I. Introduction</h2>Lors du pr&eacute;c&eacute;dent &eacute;pisode, nous avons g&eacute;n&eacute;rer un module CRUD pour notre table auteur.<br /><br />Nous allons d&eacute;tailler ici la partie formulaire d&#039;ajout.<br /><br /><h2>II. L&#039;action new du module auteurs</h2>Lorsque l&#039;on cliquer sur le lien &quot;new&quot; de notre module pr&eacute;c&eacute;dement g&eacute;n&eacute;r&eacute;, on arrive sur le module &quot;auteurs&quot;, et l&#039;action &quot;new&quot;<br />Editer le fichier module/auteur/main.php, regardons la m&eacute;thode _new()<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_new</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$tMessage</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">processSave</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oAuteur</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">row_auteur</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">_view</span><span style="color: #007700">(</span><span style="color: #DD0000">'auteurs::new'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oAuteur</span><span style="color: #007700">=</span><span style="color: #0000BB">$oAuteur</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;$oPluginXsrf</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">plugin_xsrf</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">token</span><span style="color: #007700">=</span><span style="color: #0000BB">$oPluginXsrf</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getToken</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tMessage</span><span style="color: #007700">=</span><span style="color: #0000BB">$tMessage</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oLayout</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'main'</span><span style="color: #007700">,</span><span style="color: #0000BB">$oView</span><span style="color: #007700">);<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Nous voyons ici que l&#039;on r&eacute;cup&egrave;re dans un premier temps un tableau $tMessage d&#039;une m&eacute;thode interne &quot;processSave()&quot; (nous y reviendrons apr&egrave;s)<br /><br />On instancie un objet $oAuteur &agrave; partir de la classe row_auteur.<br />Ensuite comme d&#039;habitude nous cr&eacute;ons un objet view &agrave; partir de notre vue &quot;auteurs::new) (fichier module/auteur/view.new.php)<br />Puis on lui assigne l&#039;objet $oAuteur pr&eacute;c&eacute;dement cr&eacute;&eacute;.<br /><br />Nous instancions ensuite le plugin plugin_xsrf, que nous utilisons pour assigner un token &agrave; notre vue.<br />Nous assignons le tableau $tMessage r&eacute;cup&eacute;r&eacute; &agrave; la premi&egrave;re ligne.<br /><br />Et enfin nous envoyons notre vue enrichier &agrave; notre layout (&agrave; l&#039;emplacement principal &quot;main&quot;)<br /><br /><h2>III. Zoom sur notre vue new</h2>Nous avons vu que nous instancions la vue auteurs::new<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php<br />$oForm</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">plugin_form</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oAuteur</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$oForm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setMessage</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tMessage</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;<br /></span>&lt;form&nbsp;action=""&nbsp;method="POST"&nbsp;&gt;<br />&lt;table&nbsp;class="tb_new"&gt;<br />&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Nom&lt;/th&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oForm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getInputText</span><span style="color: #007700">(</span><span style="color: #DD0000">'nom'</span><span style="color: #007700">)</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Pr&amp;eacute;nom&lt;/th&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oForm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getInputText</span><span style="color: #007700">(</span><span style="color: #DD0000">'prenom'</span><span style="color: #007700">)</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;&lt;/th&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="submit"&nbsp;value="Ajouter"&nbsp;/&gt;&nbsp;&lt;a&nbsp;href="<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLink</span><span style="color: #007700">(</span><span style="color: #DD0000">'auteurs::list'</span><span style="color: #007700">)</span><span style="color: #0000BB">?&gt;</span>"&gt;Annuler&lt;/a&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br />&lt;/table&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oForm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getToken</span><span style="color: #007700">(</span><span style="color: #DD0000">'token'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">token</span><span style="color: #007700">)</span><span style="color: #0000BB">?&gt;<br /></span>&lt;/form&gt;<br />&nbsp;&nbsp;&nbsp;</span><br />
</code></div>Dans cette vue, nous retrouvons notre objet $oAuteur ainsi que notre tableau $tMessage pr&eacute;c&eacute;dement assign&eacute;s.<br />Nous voyons &eacute;galement la cr&eacute;ation d&#039;un objet plugin_form, utilis&eacute; ensuite pour construire nos diff&eacute;rents champs de formulaire.<br />Exemple:<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">td</span><span style="color: #007700">&gt;&lt;?</span><span style="color: #0000BB">php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oForm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getInputText</span><span style="color: #007700">(</span><span style="color: #DD0000">'nom'</span><span style="color: #007700">)</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;</span><br />
</code></div>Notez &eacute;galement deux choses: un lien permettant de revenir au tableau listant les enregistrements<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">a&nbsp;href</span><span style="color: #007700">=</span><span style="color: #DD0000">"&lt;?php&nbsp;echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLink</span><span style="color: #DD0000">('auteurs::list')?&gt;"</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">Annuler</span><span style="color: #007700">&lt;/</span><span style="color: #0000BB">a</span><span style="color: #007700">&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Et &eacute;galement un code permettant d&#039;afficher le fameux token<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oForm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getToken</span><span style="color: #007700">(</span><span style="color: #DD0000">'token'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">token</span><span style="color: #007700">)</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;</span><br />
</code></div>Pour information, le token sert ici &agrave; se prot&eacute;ger de la faille xsrf, plus d&#039;informations sur <a href="security.html">la page de sp&eacute;cialis&eacute; sur la s&eacute;curit&eacute; </a><br /><br />Il nous reste une chose &agrave; voir: ce fameux tableau $tMessage r&eacute;cup&eacute;r&eacute; dans le module, assign&eacute; &agrave; la vue pour etre pass&eacute;e &agrave; l&#039;objet plugin_form.<br /><br /><h2>IV. tableau $tMessage et la m&eacute;thode processSave()</h2>Dans le module, nous avons vu en amont de l&#039;action _new()<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_new</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$tMessage</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">processSave</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Allons voir ce que cette m&eacute;thode contient:<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">private&nbsp;function&nbsp;</span><span style="color: #0000BB">processSave</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getRequest</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">isPost</span><span style="color: #007700">()&nbsp;){&nbsp;</span><span style="color: #FF8000">//si&nbsp;ce&nbsp;n'est&nbsp;pas&nbsp;une&nbsp;requete&nbsp;POST&nbsp;on&nbsp;ne&nbsp;soumet&nbsp;pas<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;$oPluginXsrf</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">plugin_xsrf</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">$oPluginXsrf</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">checkToken</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'token'</span><span style="color: #007700">)&nbsp;)&nbsp;){&nbsp;</span><span style="color: #FF8000">//on&nbsp;verifie&nbsp;que&nbsp;le&nbsp;token&nbsp;est&nbsp;valide<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;array(</span><span style="color: #DD0000">'token'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$oPluginXsrf</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()&nbsp;);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$iId</span><span style="color: #007700">=</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,</span><span style="color: #0000BB">null</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$iId</span><span style="color: #007700">==</span><span style="color: #0000BB">null</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oAuteur</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">row_auteur</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}else{<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oAuteur</span><span style="color: #007700">=</span><span style="color: #0000BB">model_auteur</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findById</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;$tColumn</span><span style="color: #007700">=array(</span><span style="color: #DD0000">'nom'</span><span style="color: #007700">,</span><span style="color: #DD0000">'prenom'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$tColumn&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$sColumn</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oAuteur</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$sColumn</span><span style="color: #007700">=</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #0000BB">$sColumn</span><span style="color: #007700">,</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$oAuteur</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">()){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//une&nbsp;fois&nbsp;enregistre&nbsp;on&nbsp;redirige&nbsp;(vers&nbsp;la&nbsp;page&nbsp;liste)<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_root</span><span style="color: #007700">::</span><span style="color: #0000BB">redirect</span><span style="color: #007700">(</span><span style="color: #DD0000">'auteurs::list'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}else{<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oAuteur</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getListError</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>En amont de cette m&eacute;thode, on v&eacute;rifie si la requ&ecirc;te web est de type post, si ce n&#039;est pas le cas, le formulaire n&#039;a pas &eacute;t&eacute; soumis, la m&eacute;thode ne renvoit rien.<br /><br />Ensuite, on instancie l&#039;objet plugin_xsrf pour v&eacute;rifier que le jeton est valide*.<br />* <a href="security.html">la page de sp&eacute;cialis&eacute; sur la s&eacute;curit&eacute; </a><br /><br />On r&eacute;cup&egrave;re l&#039;id de l&#039;auteur: si il est vid&eacute;, on est dans le cas d&#039;un ajout, sinon on est dans le cadre d&#039;une modification.<br />Dans notre cas pr&eacute;sent de l&#039;action _new(), on a l&#039;id non renseign&eacute; (premier cas)<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br />$iId</span><span style="color: #007700">=</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,</span><span style="color: #0000BB">null</span><span style="color: #007700">);<br />if(</span><span style="color: #0000BB">$iId</span><span style="color: #007700">==</span><span style="color: #0000BB">null</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oAuteur</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">row_auteur</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>On instancie un objet row_auteur vide<br />Puis on boucle sur les champs du formulaire pour les renseigner sur l&#039;objet &agrave; partir des param&egrave;tres soumis via le formulaire.<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br />$tColumn</span><span style="color: #007700">=array(</span><span style="color: #DD0000">'nom'</span><span style="color: #007700">,</span><span style="color: #DD0000">'prenom'</span><span style="color: #007700">);<br />foreach(</span><span style="color: #0000BB">$tColumn&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$sColumn</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oAuteur</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$sColumn</span><span style="color: #007700">=</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #0000BB">$sColumn</span><span style="color: #007700">,</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Enfin on &eacute;ssaie d&#039;enregistrer:<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">if(</span><span style="color: #0000BB">$oAuteur</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">()){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//une&nbsp;fois&nbsp;enregistre&nbsp;on&nbsp;redirige&nbsp;(vers&nbsp;la&nbsp;page&nbsp;liste)<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;_root</span><span style="color: #007700">::</span><span style="color: #0000BB">redirect</span><span style="color: #007700">(</span><span style="color: #DD0000">'auteurs::list'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Si cela se passe bien, on redirige vers la page contenant le tableau des auteurs.<br />Sinon<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">}else{<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oAuteur</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getListError</span><span style="color: #007700">();<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>On retourne le tableau des erreurs.<br /><br />Qui pour rappel &eacute;tait r&eacute;cup&eacute;r&eacute; dans notre m&eacute;thode _new() dans un tableau $tMessage<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_new</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$tMessage</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">processSave</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Puis assign&eacute; &agrave; notre vue<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br />$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tMessage</span><span style="color: #007700">=</span><span style="color: #0000BB">$tMessage</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Enfin celui-ci &eacute;tait charg&eacute; dans l&#039;objet plugin_form<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php<br />$oForm</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">plugin_form</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oAuteur</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$oForm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setMessage</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tMessage</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div><br /><h2>V. Gestion d&#039;enregistrement: ajout de contraintes</h2>Actuellement, on peut ajouter un auteur sans nom ni pr&eacute;nom ce qui n&#039;est pas coh&eacute;rent<br /><br />Nous allons ajouter une contrainte pour obliger &agrave; renseigner un nom et pr&eacute;nom.<br />Editez le fichier model model/model_auteur.php<br />Regardons la class row_auteur<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">row_auteur&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">abstract_row</span><span style="color: #007700">{<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;</span><span style="color: #0000BB">$sClassModel</span><span style="color: #007700">=</span><span style="color: #DD0000">'model_auteur'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*exemple&nbsp;jointure<br />&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;findAuteur(){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;model_auteur::getInstance()-&gt;findById($this-&gt;auteur_id);<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;*/<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*exemple&nbsp;test&nbsp;validation*/<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">private&nbsp;function&nbsp;</span><span style="color: #0000BB">getCheck</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">plugin_valid</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getTab</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;renseigner&nbsp;vos&nbsp;check&nbsp;ici<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isEqual('champ','valeurB','Le&nbsp;champ&nbsp;n\est&nbsp;pas&nbsp;&amp;eacute;gal&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isNotEqual('champ','valeurB','Le&nbsp;champ&nbsp;est&nbsp;&amp;eacute;gal&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isUpperThan('champ','valeurB','Le&nbsp;champ&nbsp;n\est&nbsp;pas&nbsp;sup&amp;eacute;&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isUpperOrEqualThan('champ','valeurB','Le&nbsp;champ&nbsp;n\est&nbsp;pas&nbsp;sup&amp;eacute;&nbsp;ou&nbsp;&amp;eacute;gal&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isLowerThan('champ','valeurB','Le&nbsp;champ&nbsp;n\est&nbsp;pas&nbsp;inf&amp;eacute;rieur&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isLowerOrEqualThan('champ','valeurB','Le&nbsp;champ&nbsp;n\est&nbsp;pas&nbsp;inf&amp;eacute;rieur&nbsp;ou&nbsp;&amp;eacute;gal&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isEmpty('champ','Le&nbsp;champ&nbsp;n\'est&nbsp;pas&nbsp;vide');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isNotEmpty('champ','Le&nbsp;champ&nbsp;ne&nbsp;doit&nbsp;pas&nbsp;&amp;ecirc;tre&nbsp;vide');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isEmailValid('champ','L\email&nbsp;est&nbsp;invalide');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;matchExpression('champ','/[0-9]/','Le&nbsp;champ&nbsp;n\'est&nbsp;pas&nbsp;au&nbsp;bon&nbsp;format');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;notMatchExpression('champ','/[a-zA-Z]/','Le&nbsp;champ&nbsp;ne&nbsp;doit&nbsp;pas&nbsp;&amp;ecirc;tre&nbsp;a&nbsp;ce&nbsp;format');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br /><br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oPluginValid</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">isValid</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCheck</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">isValid</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getListError</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCheck</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getListError</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">save</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isValid</span><span style="color: #007700">()){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent</span><span style="color: #007700">::</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>On peut voir ici, qu&#039;&agrave; l&#039;appel de la m&eacute;thode save() de notre objet, on v&eacute;rifie la coh&eacute;rence via la m&eacute;thode getCheck()<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">isValid</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCheck</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">isValid</span><span style="color: #007700">();<br />}<br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">getListError</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCheck</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getListError</span><span style="color: #007700">();<br />}<br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">save</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isValid</span><span style="color: #007700">()){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;parent</span><span style="color: #007700">::</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Pour rappel, dans le cas ou cette m&eacute;thode retournerai false, on appelle getListError()<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">if(</span><span style="color: #0000BB">$oAuteur</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">()){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//une&nbsp;fois&nbsp;enregistre&nbsp;on&nbsp;redirige&nbsp;(vers&nbsp;la&nbsp;page&nbsp;liste)<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;_root</span><span style="color: #007700">::</span><span style="color: #0000BB">redirect</span><span style="color: #007700">(</span><span style="color: #DD0000">'auteurs::list'</span><span style="color: #007700">);<br />}else{<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oAuteur</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getListError</span><span style="color: #007700">();<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div><br /><h2>VI. Zoom sur la m&eacute;thode getCheck()</h2><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">private&nbsp;function&nbsp;</span><span style="color: #0000BB">getCheck</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oPluginValid</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">plugin_valid</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getTab</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;renseigner&nbsp;vos&nbsp;check&nbsp;ici<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isEqual('champ','valeurB','Le&nbsp;champ&nbsp;n\est&nbsp;pas&nbsp;&amp;eacute;gal&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isNotEqual('champ','valeurB','Le&nbsp;champ&nbsp;est&nbsp;&amp;eacute;gal&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isUpperThan('champ','valeurB','Le&nbsp;champ&nbsp;n\est&nbsp;pas&nbsp;sup&amp;eacute;&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isUpperOrEqualThan('champ','valeurB','Le&nbsp;champ&nbsp;n\est&nbsp;pas&nbsp;sup&amp;eacute;&nbsp;ou&nbsp;&amp;eacute;gal&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isLowerThan('champ','valeurB','Le&nbsp;champ&nbsp;n\est&nbsp;pas&nbsp;inf&amp;eacute;rieur&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isLowerOrEqualThan('champ','valeurB','Le&nbsp;champ&nbsp;n\est&nbsp;pas&nbsp;inf&amp;eacute;rieur&nbsp;ou&nbsp;&amp;eacute;gal&nbsp;&amp;agrave;&nbsp;'.$valeurB);<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isEmpty('champ','Le&nbsp;champ&nbsp;n\'est&nbsp;pas&nbsp;vide');<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isNotEmpty('champ','Le&nbsp;champ&nbsp;ne&nbsp;doit&nbsp;pas&nbsp;&amp;ecirc;tre&nbsp;vide');<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;isEmailValid('champ','L\email&nbsp;est&nbsp;invalide');<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;matchExpression('champ','/[0-9]/','Le&nbsp;champ&nbsp;n\'est&nbsp;pas&nbsp;au&nbsp;bon&nbsp;format');<br />&nbsp;&nbsp;&nbsp;$oPluginValid-&gt;notMatchExpression('champ','/[a-zA-Z]/','Le&nbsp;champ&nbsp;ne&nbsp;doit&nbsp;pas&nbsp;&amp;ecirc;tre&nbsp;a&nbsp;ce&nbsp;format');<br />&nbsp;&nbsp;&nbsp;*/<br /><br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oPluginValid</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Vous avez ici des exemples de contraintes comment&eacute;e. Ici nous souhaitons que les champs nom et pr&eacute;nom ne soient pas vide, nous allons ajouter ces deux contraintes ainsi<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">private&nbsp;function&nbsp;</span><span style="color: #0000BB">getCheck</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oPluginValid</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">plugin_valid</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getTab</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oPluginValid</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isNotEmpty</span><span style="color: #007700">(</span><span style="color: #DD0000">'nom'</span><span style="color: #007700">,</span><span style="color: #DD0000">'Le&nbsp;nom&nbsp;ne&nbsp;doit&nbsp;pas&nbsp;&amp;ecirc;tre&nbsp;vide'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oPluginValid</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isNotEmpty</span><span style="color: #007700">(</span><span style="color: #DD0000">'prenom'</span><span style="color: #007700">,</span><span style="color: #DD0000">'Le&nbsp;pr&amp;eacute;nom&nbsp;ne&nbsp;doit&nbsp;pas&nbsp;&amp;ecirc;tre&nbsp;vide'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oPluginValid</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Pour pr&eacute;ciser: le premier champ est le nom du champ en base de donn&eacute;es, et le second param&egrave;tre le message d&#039;erreur en cas de contrainte non respect&eacute;e.<br />En validant le formulaire vide, on voit ici les deux messages d&#039;erreur:<br /><img src="data/img/podcastTuto_3siteNew.jpg" /><br /><br />Pour information, les contraintes &eacute;tant ajout&eacute;e sur la classe mod&egrave;le, toute action enregistrant via cette classe un auteur se devra de respect&eacute;es cette m&eacute;thode getCheck, que ce soit en web, webservice, ligne de commande...<br /><br /><br />	 
		</div>	
	 
		</main>
	 
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="site/js/jquery-3.2.1.slim.min.js" ></script>
     <script src="site/js/bootstrap.min.js" ></script>
  </body>
</html>

<!--cache -->