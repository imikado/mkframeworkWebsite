<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="iso-8859-1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MkFramework V4</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

<link rel="stylesheet" type="text/css" href="site/css/main.css" media="screen" />
<script src="site/js/main.js" type="text/javascript"></script>

<link rel="alternate" type="application/rss+xml" title="RSS" href="news.rss"/>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34332613-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body>
	
	<!-- Fixed navbar -->
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
         
          <a class="navbar-brand" href="/">MkFramework</a>
        </div>
        <div class="navbar-collapse collapse">
          
          <ul class="nav navbar-nav navbar-right">
           			<li><a style="font-weight:bold" href="bigtutoriel_socialnetwork_VI.html">FR</a></li>
			
			<li><a  href="bigtutoriel_socialnetwork_VI.html">EN</a></li>
			
			
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
	 

 
		
		
		
	<div class="container">


      <div class="row">

        <div class="col-sm-8 blog-main">
		<h1>Cr&eacute;ation d&#039;un r&eacute;seau social avec le mkframework</h1><br />-<a href="bigtutoriel_socialnetwork_I.html">I Pr&eacute;ambule </a><br />-<a href="bigtutoriel_socialnetwork_II.html">II Cr&eacute;ation et initialisation du projet </a><br />-<a href="bigtutoriel_socialnetwork_III.html">III L&#039;authentification </a><br />-<a href="bigtutoriel_socialnetwork_IV.html">IV Cr&eacute;ons notre menu </a><br />-<a href="bigtutoriel_socialnetwork_V.html">V Partie priv&eacute;e : le profil </a><br />-<a style="font-weight:bold" href="bigtutoriel_socialnetwork_VI.html">VI Partie priv&eacute;e : votre r&eacute;seaux de contacts </a><br />-<a href="bigtutoriel_socialnetwork_VII.html">VII Partie priv&eacute;e : votre fil </a><br />-<a href="bigtutoriel_socialnetwork_VIII.html">VIII Partie priv&eacute;e : administrez vos photos </a><br />-<a href="bigtutoriel_socialnetwork_IX.html">IX Profil partag&eacute; </a><br />-<a href="bigtutoriel_socialnetwork_X.html">X Design/ esth&eacute;tique </a><br />-<a href="bigtutoriel_socialnetwork_XI.html">XI Conclusion </a><br /><br /><h1>VI Partie priv&eacute;e : votre r&eacute;seaux de contacts</h1><h2>VI.A Introduction</h2>A partir de l&agrave;, le r&eacute;seau de contacts va &ecirc;tre n&eacute;cessaire: que l&#039;on choisisse de poster un<br />message, ou d&#039;administrer ses photos, il nous faudra choisir avec qui les partager.<br />Avant de commencer cette partie, il nous faudrait ajouter quelques individus sur notre<br />application<br />Profitez de notre page d&#039;inscription pour ajouter quelques personnes<br />Vicor Hugo, Albert Camus, Isaac Asimov, George Lucas, Steven Spielberg et Justin Bieber<br />Pour permettre de g&eacute;rer nos groupes, nous allons utiliser la m&ecirc;me technique que la<br />pr&eacute;c&eacute;dente: cr&eacute;er un CRUD, puis l&#039;inclure dans notre page<br /><br /><h2>VI.B Cr&eacute;ons notre module groups</h2>Rendez-vous sur le builder, sur la partie module CRUD int&eacute;grable<br /><img src="data/img/builderCrudGroups.png" /><br />On se retrouve avec notre module permettant d&#039;administrer nos groupes, on va le customiser, puis l&#039;inclure<br /><br /><h2>VI.C Permettre de forcer l&#039;utilisateur</h2>Ici, notre module va nous permettre d&#039;administrer les groupes de l&#039;utilisateur concern&eacute;, on va<br />donc ajouter une propri&eacute;t&eacute; et une m&eacute;thode pour d&eacute;finir l&#039;utilisateur, puis prendre en compte<br />cette propri&eacute;t&eacute; lors de l&#039;enregistrement<br />Ajoutez au d&eacute;but du module &quot;groups&quot;<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">private&nbsp;</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">;<br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">setUserId</span><span style="color: #007700">(</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">=(int)</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Et dans la m&eacute;thode save()<br />For&ccedil;ons le user_id avec cette propri&eacute;t&eacute;<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #FF8000">//on&nbsp;force&nbsp;le&nbsp;user_id&nbsp;avec&nbsp;la&nbsp;propriete&nbsp;de&nbsp;notre&nbsp;module<br /></span><span style="color: #0000BB">$oGroups</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$oGroups</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Changeons la requ&ecirc;te faite pour r&eacute;cup&eacute;rer les groupes filtr&eacute; par utilisateur<br />Dans la m&eacute;thode _list()<br />Remplacer<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br />$tGroups</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Groups</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findAll</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Par<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br />$tGroups</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Groups</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findListByUser</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Et ajoutons une requ&ecirc;te dans notre classe mod&egrave;le<br />Ajouter dans le fichier <u>model/model_Groups.php</u> la m&eacute;thode suivante:<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">findListByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">findMany</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sTable</span><span style="color: #007700">.</span><span style="color: #DD0000">'&nbsp;WHERE&nbsp;user_id=?'</span><span style="color: #007700">,(int)</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">);<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div><br /><h2>VI.D Int&eacute;grer notre module groups</h2>&Eacute;ditons notre fichier <u>module/mainPrivate/main.php</u><br />Dans notre m&eacute;thode _friends, on va ajouter l&#039;appel &agrave; notre module<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_friends</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oModuleGroups</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">module_Groups</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oModuleGroups</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setUserId</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getAuth</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getAccount</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">id&nbsp;</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oViewGroups</span><span style="color: #007700">=</span><span style="color: #0000BB">$oModuleGroups</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_index</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oLayout</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'main'</span><span style="color: #007700">,</span><span style="color: #0000BB">$oViewGroups</span><span style="color: #007700">);<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div><img src="data/img/siteFriends.png" /><br />Vous pouvez d&eacute;sormais ajouter des groupes, par exempes &quot;potes &eacute;crivains&quot; et &quot;R&eacute;alisateurs&quot;<br /><img src="data/img/siteFriends2.png" /><br />A ce stade, vous pouvez administrer des groupes, c&#039;est bien, maintenant, voyons comment ajouter des contacts<br /><br /><h2>VI.E Cr&eacute;ons un module contacts</h2>Rendez-vous sur le builder, sur la partie &quot;cr&eacute;er un module int&eacute;grable&quot;<br />Ici, on va cr&eacute;er un module qui permettra de lister nos contacts ,d&#039;en chercher de nouveaux,de leur proposer de devenir un de nos contacts et bien sur d&#039;accepter ou de refuser.<br />Cr&eacute;ons le module &quot;contacts&quot; avec les actions list,find,ask,accept et refuse<br /><img src="data/img/builderModuleContacts.png" /><br />Cliquez sur le bouton &quot;g&eacute;n&eacute;rer&quot;<br />Dans notre module, nous allons d&#039;abord ajouter une propri&eacute;t&eacute; pour d&eacute;finir l&#039;utilisateur<br />&Eacute;diter le fichier <u>module/contacts/main.php</u><br />Ajouter au d&eacute;but<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">private&nbsp;</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">;<br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">setUserId</span><span style="color: #007700">(</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">=(int)</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Modifions la m&eacute;thode _list()<br />Elle nous permettra de lister les contacts, mais &eacute;galement les demandes que l&#039;utilisateur a faite (ou dont il fait l&#039;objet).<br />Mais pour cela ajoutons des requ&ecirc;tes &agrave; notre mod&egrave;le friends:<br />- pour r&eacute;cup&eacute;rer nos contacts<br />- pour r&eacute;cup&eacute;rer nos demandes en attente<br />- pour r&eacute;cup&eacute;rer les demandes des autres utilisateurs &agrave; valider<br /><br />Pour cela &eacute;ditons notre fichier <u>model/model_friends.php</u><br />Ajoutons en amont des constantes qui d&eacute;finirons les diff&eacute;rents &eacute;tats pending, acceped et refused<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">const&nbsp;</span><span style="color: #0000BB">STATE_PENDING</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />const&nbsp;</span><span style="color: #0000BB">STATE_ACCEPTED</span><span style="color: #007700">=</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />const&nbsp;</span><span style="color: #0000BB">STATE_REFUSED</span><span style="color: #007700">=</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Ensuite ajoutons nos 3 requ&ecirc;tes<br />Pour &eacute;crire une requ&ecirc;te avec l&#039;orm, choisissez d&#039;abord si vous souhaitez r&eacute;cup&eacute;rer un ou<br />plusieurs enregistrements, vous utiliserez findOne ou findMany auxquels vous passerez votre<br />requ&ecirc;te comme premier argument (dont les param&egrave;tres seront remplac&eacute;s par un point<br />d&#039;interrogation) et vos param&egrave;tres comme autres arguments<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">findListAcceptedByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">findMany</span><span style="color: #007700">(<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;*,&nbsp;Friends.id&nbsp;as&nbsp;friend_id&nbsp;FROM&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sTable</span><span style="color: #007700">.</span><span style="color: #DD0000">',Users<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Friends.state='</span><span style="color: #007700">.</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_ACCEPTED</span><span style="color: #007700">.</span><span style="color: #DD0000">'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;Users.id=Friends.user_id2&nbsp;and&nbsp;Friends.user_id=?)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Friends.state='</span><span style="color: #007700">.</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_ACCEPTED</span><span style="color: #007700">.</span><span style="color: #DD0000">'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;Users.id=Friends.user_id&nbsp;and&nbsp;Friends.user_id2=?)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">,(int)</span><span style="color: #0000BB">$user_id<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">,(int)</span><span style="color: #0000BB">$user_id<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">findListPendingByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">findMany</span><span style="color: #007700">(<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sTable</span><span style="color: #007700">.</span><span style="color: #DD0000">',Users<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;Users.id=Friends.user_id2<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;Friends.user_id=?<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;Friends.state=?&nbsp;'<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">,(int)</span><span style="color: #0000BB">$user_id<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">,</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_PENDING<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">findListToValidateByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">findMany</span><span style="color: #007700">(<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;*,&nbsp;Friends.id&nbsp;as&nbsp;friend_id<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sTable</span><span style="color: #007700">.</span><span style="color: #DD0000">',Users<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;Users.id=Friends.user_id<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;Friends.user_id2=?<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;Friends.state=?&nbsp;'<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">,(int)</span><span style="color: #0000BB">$user_id<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">,</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_PENDING<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Revenons &agrave; notre contr&ocirc;leur pour r&eacute;cup&eacute;rer le r&eacute;sultat de ces requ&ecirc;tes<br />&Eacute;diter le fichier <u>module/contacts/main.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_list</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oViewContactsAccepted</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getList</span><span style="color: #007700">(</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findListAcceptedByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oViewContactsPending</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getList</span><span style="color: #007700">(</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findListPendingByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oViewContactsToValidate</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getList</span><span style="color: #007700">(</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findListToValidateByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">_view</span><span style="color: #007700">(</span><span style="color: #DD0000">'contacts::list'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oViewContactsAccepted</span><span style="color: #007700">=</span><span style="color: #0000BB">$oViewContactsAccepted</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oViewContactsPending</span><span style="color: #007700">=</span><span style="color: #0000BB">$oViewContactsPending</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oViewContactsToValidate</span><span style="color: #007700">=</span><span style="color: #0000BB">$oViewContactsToValidate</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oView</span><span style="color: #007700">;<br />}<br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">getList</span><span style="color: #007700">(</span><span style="color: #0000BB">$tContacts</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">_view</span><span style="color: #007700">(</span><span style="color: #DD0000">'contacts::listembedded'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts</span><span style="color: #007700">=</span><span style="color: #0000BB">$tContacts</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oView</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Cot&eacute; vue, nous listerons ces contacts<br />Cr&eacute;ez un fichier <u>module/contacts/view/listembedded.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts</span><span style="color: #007700">):</span><span style="color: #0000BB">?&gt;<br /></span>&lt;table&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">):</span><span style="color: #0000BB">?&gt;<br /></span>&lt;tr&gt;<br />&lt;td&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">lastname&nbsp;?&gt;</span>&lt;/td&gt;<br />&lt;td&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">firstname&nbsp;?&gt;</span>&lt;/td&gt;<br />&lt;/tr&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">endforeach;</span><span style="color: #0000BB">?&gt;<br /></span>&lt;/table&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">else:</span><span style="color: #0000BB">?&gt;<br /></span>Aucun&nbsp;pour&nbsp;le&nbsp;moment<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">endif;</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;</span><br />
</code></div><br />&Eacute;ditez le fichier <u>module/contacts/view/list.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">h1</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">Mes&nbsp;contacts</span><span style="color: #007700">&lt;/</span><span style="color: #0000BB">h1</span><span style="color: #007700">&gt;<br />&lt;?</span><span style="color: #0000BB">php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oViewContactsAccepted</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">show</span><span style="color: #007700">()</span><span style="color: #0000BB">?&gt;<br /></span><br />&lt;h1&gt;Mes&nbsp;demandes&nbsp;de&nbsp;contacts&nbsp;envoy&amp;eacute;es&lt;/h1&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oViewContactsPending</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">show</span><span style="color: #007700">()</span><span style="color: #0000BB">?&gt;<br /></span><br />&lt;h1&gt;Les&nbsp;demandes&nbsp;de&nbsp;contacts&nbsp;&amp;agrave;&nbsp;valider&lt;/h1&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oViewContactsToValidate</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">show</span><span style="color: #007700">()</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;</span><br />
</code></div>Int&eacute;grons-le &agrave; notre module mainPrivate, pour cela, &eacute;diter le fichier <u>module/mainPrivate/main.php</u><br />Ajoutez &agrave; la fin de la m&eacute;thode _friends() (en dessous de l&#039;inclusion du module groups)<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br />$oModuleContacts</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">module_contacts</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$oModuleContacts</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setUserId</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getAuth</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getAccount</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">id&nbsp;</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$oViewContacts</span><span style="color: #007700">=</span><span style="color: #0000BB">$oModuleContacts</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_list</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oLayout</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'main'</span><span style="color: #007700">,</span><span style="color: #0000BB">$oViewContacts</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div><img src="data/img/siteContacts.png" /><br />Comme vous pouvez le voir, le module &quot;contacts&quot; a &eacute;t&eacute; ajout&eacute; &agrave; la suite du module &quot;groups&quot;, ceci gr&acirc;ce aux appels successifs &agrave; $this-&gt;oLayout-&gt;add() qui a ajout&eacute; les vues &agrave; l&#039;emplacement &quot;main&quot;<br />Nous allons ensuite permettre de rechercher des utilisateurs et de leur demander de figurer parmi vos contacts.<br />Commen&ccedil;ons par ajouter dans notre couche mod&egrave;le une requ&ecirc;te recherchant dans la liste des utilisateurs.<br />&Eacute;ditez le fichier <u>model/model_Users.php</u><br />Ajouter la m&eacute;thode suivante:<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">findListByPattern</span><span style="color: #007700">(</span><span style="color: #0000BB">$sPattern</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$sPattern</span><span style="color: #007700">=</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$sPattern</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">findMany</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sTable</span><span style="color: #007700">.</span><span style="color: #DD0000">'&nbsp;WHERE&nbsp;lastname&nbsp;like&nbsp;?&nbsp;or&nbsp;firstname&nbsp;like&nbsp;?'</span><span style="color: #007700">,</span><span style="color: #0000BB">$sPattern</span><span style="color: #007700">,</span><span style="color: #0000BB">$sPattern</span><span style="color: #007700">);<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>On effectue une recherche en base de donn&eacute;e avec la commande like et en encadrant du signe pourcentage<br />&Eacute;ditons ensuite le contr&ocirc;leur pour faire l&#039;appel et r&eacute;cup&eacute;rez la liste des utilisateurs trouv&eacute;<br />&Eacute;ditons le fichier <u>module/contacts/main.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_find</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$tUserFound</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getRequest</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">isPost</span><span style="color: #007700">()&nbsp;and&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'pattern'</span><span style="color: #007700">)){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tUserFound</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Users</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findListByPattern</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'pattern'</span><span style="color: #007700">)&nbsp;);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">_view</span><span style="color: #007700">(</span><span style="color: #DD0000">'contacts::find'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tUserFound</span><span style="color: #007700">=</span><span style="color: #0000BB">$tUserFound</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oView</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Editons ensuite la vue, fichier <u>module/contacts/view/find.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">hr</span><span style="color: #007700">/&gt;<br />&lt;</span><span style="color: #0000BB">h1</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">Rechercher</span><span style="color: #007700">&lt;/</span><span style="color: #0000BB">h1</span><span style="color: #007700">&gt;<br />&lt;</span><span style="color: #0000BB">form&nbsp;action</span><span style="color: #007700">=</span><span style="color: #DD0000">""&nbsp;</span><span style="color: #0000BB">method</span><span style="color: #007700">=</span><span style="color: #DD0000">"POST"</span><span style="color: #007700">&gt;<br />&lt;</span><span style="color: #0000BB">p</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">Rechercher&nbsp;</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">"text"&nbsp;</span><span style="color: #0000BB">name</span><span style="color: #007700">=</span><span style="color: #DD0000">"pattern"&nbsp;</span><span style="color: #007700">/&gt;&nbsp;&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">"submit"<br /></span><span style="color: #0000BB">value</span><span style="color: #007700">=</span><span style="color: #DD0000">"Rechercher"</span><span style="color: #007700">/&gt;&lt;/</span><span style="color: #0000BB">p</span><span style="color: #007700">&gt;<br />&lt;/</span><span style="color: #0000BB">form</span><span style="color: #007700">&gt;<br />&lt;?</span><span style="color: #0000BB">php&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getRequest</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">isPost</span><span style="color: #007700">()&nbsp;and&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'pattern'</span><span style="color: #007700">)):</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;&lt;h1&gt;R&amp;eacute;sultat(s)&nbsp;de&nbsp;recherche&lt;/h1&gt;<br />&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tUserFound</span><span style="color: #007700">):</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;table&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tUserFound&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$oUserFound</span><span style="color: #007700">):</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oUserFound</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">lastname?&gt;</span>&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oUserFound</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">firstname?&gt;</span>&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">endforeach;</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/table&gt;<br />&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">else:</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Aucun&nbsp;r&amp;eacute;sultats&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">endif;</span><span style="color: #0000BB">?&gt;<br />&lt;?php&nbsp;</span><span style="color: #007700">endif;</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;</span><br />
</code></div>Incluons cette recherche dans notre module mainPrivate<br />Ajoutez &agrave; la fin de la m&eacute;thode _friends() ceci dans le fichier <u>module/mainPrivate/main.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br />$oViewFind</span><span style="color: #007700">=</span><span style="color: #0000BB">$oModuleContacts</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_find</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oLayout</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'main'</span><span style="color: #007700">,</span><span style="color: #0000BB">$oViewFind</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>On peut d&eacute;sormais rechercher des utilisateurs, par exemple taper &quot;ca&quot;<br /><img src="data/img/siteContactsFind.png" /><br />Il trouve deux utilisateurs dont le nom ou le pr&eacute;nom contienne &quot;ca&quot;<br />Ajoutons maintenant un lien pour leur demander de figurer dans nos contacts.<br />&Eacute;ditons la m&eacute;thode _ask() de notre contr&ocirc;leur <u>module/contacts/main.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_ask</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oUserToAsk</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Users</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findById</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$oUserToAsk</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//si&nbsp;l'utilisateur&nbsp;existe,&nbsp;on&nbsp;cree&nbsp;une&nbsp;demande<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oNewContact</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">row_Friends</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oNewContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">=</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getAuth</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getAccount</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oNewContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id2</span><span style="color: #007700">=</span><span style="color: #0000BB">$oUserToAsk</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oNewContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">state</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_PENDING</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oNewContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_root</span><span style="color: #007700">::</span><span style="color: #0000BB">redirect</span><span style="color: #007700">(</span><span style="color: #DD0000">'mainPrivate::friends'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Ici, en recevant l&#039;id d&#039;un utilisateur, on v&eacute;rifie qu&#039;il existe,on cr&eacute;&eacute; une demande de contact et enfin on redirige sur la page de contacts<br />Ajoutons un lien de demande de contact &agrave; la liste des utilisateurs trouv&eacute;s<br />&Eacute;ditons le fichier <u>module/contacts/view/find.php</u> et ajouter un lien<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">hr</span><span style="color: #007700">/&gt;<br />&lt;</span><span style="color: #0000BB">h1</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">Rechercher</span><span style="color: #007700">&lt;/</span><span style="color: #0000BB">h1</span><span style="color: #007700">&gt;<br />&lt;</span><span style="color: #0000BB">form&nbsp;action</span><span style="color: #007700">=</span><span style="color: #DD0000">""&nbsp;</span><span style="color: #0000BB">method</span><span style="color: #007700">=</span><span style="color: #DD0000">"POST"</span><span style="color: #007700">&gt;<br />&lt;</span><span style="color: #0000BB">p</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">Rechercher&nbsp;</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">"text"&nbsp;</span><span style="color: #0000BB">name</span><span style="color: #007700">=</span><span style="color: #DD0000">"pattern"&nbsp;</span><span style="color: #007700">/&gt;&nbsp;&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">"submit"<br /></span><span style="color: #0000BB">value</span><span style="color: #007700">=</span><span style="color: #DD0000">"Rechercher"</span><span style="color: #007700">/&gt;&lt;/</span><span style="color: #0000BB">p</span><span style="color: #007700">&gt;<br />&lt;/</span><span style="color: #0000BB">form</span><span style="color: #007700">&gt;<br />&lt;?</span><span style="color: #0000BB">php&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getRequest</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">isPost</span><span style="color: #007700">()&nbsp;and&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'pattern'</span><span style="color: #007700">)):</span><span style="color: #0000BB">?&gt;<br /></span>&lt;h1&gt;R&amp;eacute;sultat(s)&nbsp;de&nbsp;recherche&lt;/h1&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tUserFound</span><span style="color: #007700">):</span><span style="color: #0000BB">?&gt;<br /></span>&lt;table&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tUserFound&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$oUserFound</span><span style="color: #007700">):</span><span style="color: #0000BB">?&gt;<br /></span>&lt;tr&gt;<br />&lt;td&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oUserFound</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">lastname?&gt;</span>&lt;/td&gt;<br />&lt;td&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oUserFound</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">firstname?&gt;</span>&lt;/td&gt;<br />&lt;td&gt;&lt;a&nbsp;href="<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getLink</span><span style="color: #007700">(</span><span style="color: #DD0000">'contacts::ask'</span><span style="color: #007700">,<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$oUserFound</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">))<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&gt;</span>"&gt;demander&nbsp;en&nbsp;contact&lt;/a&gt;&lt;/td&gt;<br />&lt;/tr&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">endforeach;</span><span style="color: #0000BB">?&gt;<br /></span>&lt;/table&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">else:</span><span style="color: #0000BB">?&gt;<br /></span>&lt;p&gt;Aucun&nbsp;r&amp;eacute;sultats&lt;/p&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">endif;</span><span style="color: #0000BB">?&gt;<br />&lt;?php&nbsp;</span><span style="color: #007700">endif;</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;</span><br />
</code></div><img src="data/img/siteContactsFind2.png" /><br />En cliquant sur un de ces liens, on va faire notre demande de contacts, celle ci-va logiquement appara&icirc;tre dans notre liste de demande de contacts<br /><img src="data/img/siteContactsFind3.png" /><br />Si on se connecte avec un des utilisateurs &agrave; qui on a fait une demande de contact<br />On peut voir notre demande dans la liste des demandes &agrave; valider<br />Acceptons/refusons ces demandes :<br />Ajoutons ensuite deux liens permettant d&#039;accepter ou de rejeter la demande<br />Commen&ccedil;ons par ajouter l&#039;action pour accepter<br />&Eacute;ditez le fichier <u>module/contacts/main.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_accept</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">=</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getAuth</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getAccount</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oContactAsked</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findById</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)&nbsp;);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$oContactAsked&nbsp;</span><span style="color: #007700">and&nbsp;</span><span style="color: #0000BB">$oContactAsked</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id2</span><span style="color: #007700">==</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//on&nbsp;check&nbsp;qu'on&nbsp;a&nbsp;bien&nbsp;trouve&nbsp;la&nbsp;demande&nbsp;et&nbsp;qu'elle&nbsp;nous&nbsp;est&nbsp;bien&nbsp;adresse<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oContactAsked</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">accept</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_root</span><span style="color: #007700">::</span><span style="color: #0000BB">redirect</span><span style="color: #007700">(</span><span style="color: #DD0000">'mainPrivate::friends'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Lors d&#039;une acceptation, on r&eacute;cup&egrave;re d&#039;abord la demande de contact, on v&eacute;rifie que la demande concerne bien l&#039;utilisateur connect&eacute;, si c&#039;est le cas on l&#039;accepte. Et on redirige sur la page contacts.<br />Dirigeons nous vers la couche mod&egrave;le pour ajouter cette methode accept()<br />&Eacute;diter le fichier <u>model/model_Friends.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">row_Friends&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">abstract_row</span><span style="color: #007700">{<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;</span><span style="color: #0000BB">$sClassModel</span><span style="color: #007700">=</span><span style="color: #DD0000">'model_Friends'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">(...)<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">accept</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">accept</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Pour &eacute;viter d&#039;alourdir notre classe row, on fait appel &agrave; sa classe m&egrave;re<br />Pour rappel: la classe model_** execute les requ&ecirc;tes et retourne un tableau d&#039;objet row_**<br />Donc ajoutons cette m&eacute;thode accept, dans le m&ecirc;me fichier, ajouter dans la classe model_Friends cette methode accept()<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">model_Friends&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">abstract_model</span><span style="color: #007700">{<br />(...)<br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">accept</span><span style="color: #007700">(</span><span style="color: #0000BB">$oContactAsked</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oContactAsked</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">state</span><span style="color: #007700">=</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_ACCEPTED</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oContactAsked</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Ici on modifie l&#039;&eacute;tat de la demande pour la valider, puis on enregistre.<br />Faisons de m&ecirc;me pour le refus, ce qui donnera pour la classe row_Friends<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">row_Friends&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">abstract_row</span><span style="color: #007700">{<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;</span><span style="color: #0000BB">$sClassModel</span><span style="color: #007700">=</span><span style="color: #DD0000">'model_Friends'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">accept</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">accept</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">refuse</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">refuse</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">(...)<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Et pour la classe model_Friends<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">model_Friends&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">abstract_model</span><span style="color: #007700">{<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;</span><span style="color: #0000BB">$sClassRow</span><span style="color: #007700">=</span><span style="color: #DD0000">'row_Friends'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;</span><span style="color: #0000BB">$sTable</span><span style="color: #007700">=</span><span style="color: #DD0000">'Friends'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;</span><span style="color: #0000BB">$sConfig</span><span style="color: #007700">=</span><span style="color: #DD0000">'socialnetwork'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;</span><span style="color: #0000BB">$tId</span><span style="color: #007700">=array(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">const&nbsp;</span><span style="color: #0000BB">STATE_PENDING</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">const&nbsp;</span><span style="color: #0000BB">STATE_ACCEPTED</span><span style="color: #007700">=</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">const&nbsp;</span><span style="color: #0000BB">STATE_REFUSED</span><span style="color: #007700">=</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">(...)<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">accept</span><span style="color: #007700">(</span><span style="color: #0000BB">$oContactAsked</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oContactAsked</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">state</span><span style="color: #007700">=</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_ACCEPTED</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oContactAsked</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">refuse</span><span style="color: #007700">(</span><span style="color: #0000BB">$oContactAsked</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oContactAsked</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">state</span><span style="color: #007700">=</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_REFUSED</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oContactAsked</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Sans oublier l&#039;action dans le module Contacts<br />&Eacute;diter le fichier <u>module/contacts/main.php</u> pour modifier notre m&eacute;thode _refuse()<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_refuse</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">=</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getAuth</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getAccount</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oContactAsked</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findById</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)&nbsp;);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$oContactAsked&nbsp;</span><span style="color: #007700">and&nbsp;</span><span style="color: #0000BB">$oContactAsked</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id2</span><span style="color: #007700">==</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//on&nbsp;check&nbsp;qu'on&nbsp;a&nbsp;bien&nbsp;trouve&nbsp;la&nbsp;demande&nbsp;et&nbsp;qu'elle&nbsp;nous&nbsp;est&nbsp;bien&nbsp;adresse<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oContactAsked</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">refuse</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_root</span><span style="color: #007700">::</span><span style="color: #0000BB">redirect</span><span style="color: #007700">(</span><span style="color: #DD0000">'mainPrivate::friends'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Vous noterez que c&#039;est quasiment la m&ecirc;me action que _accept()<br />Maintenant, il ne reste plus qu&#039;&agrave; ajouter des liens vers ces actions<br />Modifions le fichier <u>module/contacts/main.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_list</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oViewContactsAccepted</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getList</span><span style="color: #007700">(</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findListAcceptedByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oViewContactsPending</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getList</span><span style="color: #007700">(</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findListPendingByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oViewContactsToValidate</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getListToValidate</span><span style="color: #007700">(</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findListToValidateByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">_view</span><span style="color: #007700">(</span><span style="color: #DD0000">'contacts::list'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oViewContactsAccepted</span><span style="color: #007700">=</span><span style="color: #0000BB">$oViewContactsAccepted</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oViewContactsPending</span><span style="color: #007700">=</span><span style="color: #0000BB">$oViewContactsPending</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oViewContactsToValidate</span><span style="color: #007700">=</span><span style="color: #0000BB">$oViewContactsToValidate</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oView</span><span style="color: #007700">;<br />}<br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">getList</span><span style="color: #007700">(</span><span style="color: #0000BB">$tContacts</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">_view</span><span style="color: #007700">(</span><span style="color: #DD0000">'contacts::listembedded'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts</span><span style="color: #007700">=</span><span style="color: #0000BB">$tContacts</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oView</span><span style="color: #007700">;<br />}<br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">getListToValidate</span><span style="color: #007700">(</span><span style="color: #0000BB">$tContacts</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">_view</span><span style="color: #007700">(</span><span style="color: #DD0000">'contacts::listembeddedToValidate'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts</span><span style="color: #007700">=</span><span style="color: #0000BB">$tContacts</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oView</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>&Eacute;ditez le fichier <u>module/contacts/listembeddedToValidate.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts</span><span style="color: #007700">):</span><span style="color: #0000BB">?&gt;<br /></span>&lt;table&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">):</span><span style="color: #0000BB">?&gt;<br /></span>&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">lastname&nbsp;?&gt;</span>&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">firstname&nbsp;?&gt;</span>&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href="<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getLink</span><span style="color: #007700">(</span><span style="color: #DD0000">'contacts::accept'</span><span style="color: #007700">,<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">friend_id</span><span style="color: #007700">))<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&gt;</span>"&gt;Accepter&lt;/a&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href="<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getLink</span><span style="color: #007700">(</span><span style="color: #DD0000">'contacts::refuse'</span><span style="color: #007700">,<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">friend_id</span><span style="color: #007700">))<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&gt;</span>"&gt;Refuser&lt;/a&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&lt;/tr&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">endforeach;</span><span style="color: #0000BB">?&gt;<br /></span>&lt;/table&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">else:</span><span style="color: #0000BB">?&gt;<br /></span>Aucun&nbsp;pour&nbsp;le&nbsp;moment<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">endif;</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;</span><br />
</code></div>Ainsi, si on se connecte avec les comptes des utilisateurs &agrave; qui on a demand&eacute; nos deux liens<br />Connect&eacute; en Albert Camus<br /><img src="data/img/siteAskedContacts.png" /><br />On va l&#039;accepter<br />De nouveau connect&eacute; &agrave; john doe<br /><img src="data/img/siteContacts2.png" /><br />Organisons ensuite nos contacts<br />On a des contacts, c&#039;est bien, mais on aimerait bien les regrouper, les organiser par exemple dans les groupes pr&eacute;c&eacute;demment cr&eacute;&eacute;s<br />On va modifier l&#039;action show de notre module groups qui actuellement ne sert pas &agrave; grand chose<br /><br />&Eacute;ditons la m&eacute;thode _show() de son contr&ocirc;leur dans le fichier <u>module/Groups/main.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_show</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oGroups</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Groups</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findById</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">module_Groups</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)&nbsp;);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//recuperation&nbsp;de&nbsp;la&nbsp;liste&nbsp;des&nbsp;contacts<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$tContacts</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findListAcceptedByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//recuperation&nbsp;d'un&nbsp;tableau&nbsp;contenant&nbsp;les&nbsp;membres&nbsp;de&nbsp;ce&nbsp;groupe<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$tIndexedMember</span><span style="color: #007700">=</span><span style="color: #0000BB">model_UsersGroup</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findIndexedMemberTabByGroup</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$oGroups</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">_view</span><span style="color: #007700">(</span><span style="color: #DD0000">'Groups::show'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oGroups</span><span style="color: #007700">=</span><span style="color: #0000BB">$oGroups</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts</span><span style="color: #007700">=</span><span style="color: #0000BB">$tContacts</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tIndexedMember</span><span style="color: #007700">=</span><span style="color: #0000BB">$tIndexedMember</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oView</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>On r&eacute;cup&egrave;re la liste des contacts de l&#039;utilisateur ainsi que les membres de ce groupe<br />Cr&eacute;ons cette m&eacute;thode findIndexedMemberTabByGroup dans notre classe mod&egrave;le.<br />&Eacute;ditez le fichier <u>model/model_UsersGroup.php</u><br />Y ajouter la m&eacute;thode suivante:<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">findIndexedMemberTabByGroup</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$tMember</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">findMany</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;user_id&nbsp;FROM&nbsp;UsersGroup&nbsp;WHERE&nbsp;group_id=?'</span><span style="color: #007700">,</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$tIndexed</span><span style="color: #007700">=array();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$tMember</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$tMember&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$oMember</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tIndexed</span><span style="color: #007700">[&nbsp;</span><span style="color: #0000BB">$oMember</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id&nbsp;</span><span style="color: #007700">]=</span><span style="color: #0000BB">$oMember</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$tIndexed</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>Occupons nous de la vue, o&ugrave; nous listerons les contacts et permettrons via une case &agrave; cocher, d&#039;ajouter au groupe.<br />&Eacute;ditez le fichier <u>module/Groups/view/show.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">h1</span><span style="color: #007700">&gt;&lt;?</span><span style="color: #0000BB">php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oGroups</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&nbsp;?&gt;</span>&lt;/h1&gt;<br />&lt;form&nbsp;action=""&nbsp;method="POST"&gt;<br /><span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts</span><span style="color: #007700">):</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">):</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;&lt;input&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tIndexedMember</span><span style="color: #007700">[&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">])):<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&gt;</span>checked="checked"<span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">endif;</span><span style="color: #0000BB">?&gt;</span>&nbsp;type="checkbox"&nbsp;name="tContactId[]"&nbsp;value="<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id?&gt;</span>"&nbsp;/&gt;&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">lastname&nbsp;?&gt;</span>&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$oContact</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">firstname&nbsp;?&gt;</span>&lt;br&nbsp;/&gt;<br />&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">endforeach;</span><span style="color: #0000BB">?&gt;<br />&lt;?php&nbsp;</span><span style="color: #007700">endif;</span><span style="color: #0000BB">?&gt;<br /></span>&lt;input&nbsp;type="submit"&nbsp;value="Modifier"/&gt;<br />&lt;/form&gt;<br />&nbsp;&nbsp;&nbsp;</span><br />
</code></div>Revenons &agrave; notre contr&ocirc;leur pour prendre en compte l&#039;envoi de ce formulaire<br />&Eacute;ditez le fichier <u>module/Groups/main.php</u><br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">_show</span><span style="color: #007700">(){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oGroups</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Groups</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findById</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">module_Groups</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)&nbsp;);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getRequest</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">isPost</span><span style="color: #007700">()&nbsp;and&nbsp;</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'tContactId'</span><span style="color: #007700">)){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;model_UsersGroup</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">updateMemberForGroupWithTab</span><span style="color: #007700">(</span><span style="color: #0000BB">$oGroups</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">,</span><span style="color: #0000BB">_root</span><span style="color: #007700">::</span><span style="color: #0000BB">getParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'tContactId'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//recuperation&nbsp;de&nbsp;la&nbsp;liste&nbsp;des&nbsp;contacts<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$tContacts</span><span style="color: #007700">=</span><span style="color: #0000BB">model_Friends</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findListAcceptedByUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//recuperation&nbsp;d'un&nbsp;tableau&nbsp;contenant&nbsp;les&nbsp;membres&nbsp;de&nbsp;ce&nbsp;groupe<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$tIndexedMember</span><span style="color: #007700">=</span><span style="color: #0000BB">model_UsersGroup</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findIndexedMemberTabByGroup</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">$oGroups</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">_view</span><span style="color: #007700">(</span><span style="color: #DD0000">'Groups::show'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">oGroups</span><span style="color: #007700">=</span><span style="color: #0000BB">$oGroups</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tContacts</span><span style="color: #007700">=</span><span style="color: #0000BB">$tContacts</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$oView</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tIndexedMember</span><span style="color: #007700">=</span><span style="color: #0000BB">$tIndexedMember</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$oView</span><span style="color: #007700">;<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>On y a juste ajout&eacute; dans le cas d&#039;une requ&ecirc;te post, le traitement du tableau des cases &agrave; cocher par la m&eacute;thode updateMemberForGroupWithTab() .<br />Ajoutons cette m&eacute;thode dans notre classe mod&egrave;le<br />&Eacute;ditez le fichier <u>model/model_UsersGroup.php</u> et ajoutez dans la classe model_UsersGroup<br /><div class="code"> <code><span style="color: #000000"><br />
<span style="color: #0000BB">&nbsp;&nbsp;<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">updateMemberForGroupWithTab</span><span style="color: #007700">(</span><span style="color: #0000BB">$group_id</span><span style="color: #007700">,</span><span style="color: #0000BB">$tContact</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">'DELETE&nbsp;FROM&nbsp;UsersGroup&nbsp;WHERE&nbsp;group_id=?'</span><span style="color: #007700">,(int)</span><span style="color: #0000BB">$group_id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$tContact</span><span style="color: #007700">)<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$tContact&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">){<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oUsersGroup</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">row_UsersGroup</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oUsersGroup</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">group_id</span><span style="color: #007700">=</span><span style="color: #0000BB">$group_id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oUsersGroup</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user_id</span><span style="color: #007700">=</span><span style="color: #0000BB">$user_id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oUsersGroup</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000B"></span><br />
</span><br />
</code></div>On commence par supprimer tous les membres avant de recr&eacute;er ceux envoy&eacute;s via le formulaire.<br />Ce qui donne:<br /><img src="data/img/siteContacts3.png" /><br />Ici, nous pouvons ajouter des contacts, les organiser en groupe, on est pr&ecirc;t pour ajouter les fonctions suivantes.<br />Commen&ccedil;ons par notre fil, o&ugrave; l&#039;on va dans un premier temps permettre de diffuser des messages dont nous choisirons les groupes avec qui les partager.<br /><br />Commen&ccedil;ons par &eacute;crire le module de posts &quot;page votre fil&quot;<br /><br /><p style="text-align:right">Lire la suite :  <a href="bigtutoriel_socialnetwork_VII.html">VII Partie priv&eacute;e : votre fil </a></p><br /><br /><h1>T&eacute;l&eacute;chager le zip</h1>T&eacute;l&eacute;chargez l&#039;archive du projet &agrave; cette &eacute;tape <a href="data/down/socialnetworkVI.zip">en cliquant ici </a><br />A copier dans le r&eacute;pertoire data/genere du mkframework<br />		
		</div><!-- /.blog-main -->


		<div class="col-sm-3 col-sm-offset-1 blog-sidebar">
			<a href="https://twitter.com/mkframework" class="twitter-follow-button" data-show-count="false" data-lang="fr">Suivre @mkframework</a> 
			
			<div class="sidebar-module">
					 <h4>Le site</h4>
          <ul class="nav">
							<li><a href="accueil.html">Accueil</a></li>
							<li><a href="news.html">News</a></li>
							</ul>
				 <h4>Pr&eacute;sentation</h4>
          <ul class="nav">
							<li><a href="fonctionnement.html">Sch&eacute;mas</a></li>
							<li><a href="builder.html">Le g&eacute;n&eacute;rateur web</a></li>
							<li><a href="orm.html">L'ORM <br/>(La couche mod&egrave;le)</a></li>
							<li><a href="configuration.html">Configuration</a></li>
							<li><a href="security.html">La s&eacute;curit&eacute;</a></li>
							<li><a href="api.html">L'API (Phpdoc)</a></li>
							</ul>
				 <h4>Apprendre</h4>
          <ul class="nav">
							<li><a href="start.html">D&eacute;marrer</a></li>
							<li><a href="tutoriaux.html">Tutoriaux</a></li>
							<li><a href="screencasts.html">Tutotoriaux vid&eacute;os</a></li>
							</ul>
				 <h4>T&eacute;l&eacute;charger</h4>
          <ul class="nav">
							<li><a href="telecharger.html">Framework &amp; plus</a></li>
							<li><a href="projets.html">Les applications</a></li>
							</ul>
				 <h4>Aide</h4>
          <ul class="nav">
							<li><a href="faq.html">FAQ <br/>Foire aux questions</a></li>
					<li><a target="_blank" href="http://www.developpez.net/forums/f1355/applications/projets/projets-heberges/mkframework/">Forum / aide</a></li>
		 </ul>
</div>
 
			  
             
        </div><!-- /.blog-sidebar -->

      </div><!-- /.row -->

    </div><!-- /.container -->
	
	 <div class="blog-footer">
       
      <p>
        <a href="#">Retour en haut</a>
      </p>
    </div>
	
	 
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
 
</body>
</html>

<!--cache -->